<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.whereismyhome.model.dao.tradeinfo.TradeDAO">
	
	<!-- <select id="getTradeInfoList" parameterType="map" resultType="TradeInfo">
		select dc.sidoName, dc.gugunName, dc.dongName, hi.jibun, hi.aptName,
		hd.floor, hd.dealYear, hd.dealMonth, trim(hd.dealAmount), hi.lng, hi.lat
		from houseinfo as hi
		join housedeal hd on hi.aptCode=hd.aptCode join dongcode dc on hi.dongcode = dc.dongcode
		<where>
			hi.dongCode = #{dongCode} and dealYear >= #{dealYear}
			<if test="aptName != null and aptName != ''">
				and hi.aptName like concat('%',#{aptName},'%') 
			</if>
		</where>
		order by hd.dealYear asc, hd.dealMonth asc;
	</select> -->
	
	<select id="selectTradeListWithDongCode" parameterType="map" resultMap="com.whereismyhome.resultmaps.TradeInfoResultMap">
		select
			hd.aptcode, hi.aptname, hi.dongcode, hd.area, hd.dealamount as price, hd.dealyear, hd.dealmonth, hi.buildyear
		from housedeal as hd
		join houseinfo as hi on hd.aptcode = hi.aptcode
		<where>
			hi.dongcode=#{dongcode}
			<if test="params.startYear != null">and dealyear >= #{params.startYear}</if>
			<if test="params.endYear != null"><![CDATA[and dealyear <= #{params.endYear}]]></if>
			<if test="params.startArea != null">and area >= #{params.startArea}</if>
			<if test="params.endArea != null"><![CDATA[and area <= #{params.endArea}]]></if>
			<if test="params.startPrice != null">and area >= #{params.startPrice}</if>
			<if test="params.endPrice != null"><![CDATA[and area <= #{params.endPrice}]]></if>
			<if test="params.buildYear != null">and buildyear >= #{params.buildYear}</if>
		</where>
		order by aptcode, area, dealyear, dealmonth;
	</select>
	
	<select id="selectTradeListWithAptCode" parameterType="string" resultMap="com.whereismyhome.resultmaps.TradeInfoSpecMap">
		select
			hi.buildyear, hi.aptcode, hi.aptname, hd.area, hd.dealamount as price, hd.dealyear, hd.dealmonth
		from housedeal as hd
		join houseinfo as hi on hd.aptcode=hi.aptcode
		where hd.aptcode=#{aptcode}
		order by area, dealyear, dealmonth; 
	</select>

</mapper>